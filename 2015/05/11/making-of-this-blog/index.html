<!DOCTYPE html>
<html lang="cmn" class="browser-modern">
  <head>
    <meta charset="utf-8">
    <title>这个博客是怎样搭建的 - write(2)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/static/css/app.css">
  </head>
  <body>
    <div class="page__wrap">
      <div class="page__root">
        <header class="page__header">
          <div class="page__header__content">
            <h1 class="header__title"><a href="/">write(2)</a></h1>
          </div>
        </header>
        <article class="post-article">
          <header class="article__header">
            <h1 class="article__header__title">这个博客是怎样搭建的</h1>
          </header>
          <div class="article__content"><h2>缘起</h2>

<p>实际上, 早在 2013 年我就产生了开博的打算, 当时 GitHub Pages 已经算是知名度相当高的服务了.
于是我注册了域名, 建立了 Pages 的 repo, 开始研究一些静态站点生成的东西.
然而 GitHub Pages 采用的静态站点生成器是 Ruby 阵营的 Jekyll, 因为懒得配置 Ruby
开发环境的缘故, 就一直没有开工. 毕竟我平时不写 Ruby, 单纯为了写博客配一个环境,
怎么想都是小题大作吧. 然而静态站点一定是要用工具自动生成的; 手工维护 HTML 模板和
CSS 的不优雅程度更甚于专门配置一遍 Jekyll. 因为当时本科学习即将结束, 事情很多,
就一直拖着没时间写这么一个工具, 于是拖到了现在.</p>

<p>中间 2014 年 10 月份的时候, 掺和了 <a href="http://cn.pycon.org/">PyCon China</a> 的网站建设, 听说了有
<a href="https://github.com/Ceasar/staticjinja">staticjinja</a> 这样的工具. 因为上半年做毕设接触了 Node.js 前端开发, 便产生了用
Python 搭建前端开发环境和构建系统的想法. 然而在随后的工作中, 发现 Python
的前端开发支持并没有想象中的良好, <a href="https://github.com/Kronuz/pyScss">pyScss</a> 这样的关键项目与 Ruby 或者 Node.js
生态系统中的 <a href="https://github.com/sass/sass">等价</a> <a href="https://github.com/sass/node-sass">项目</a> 并未实现真正意义上的并驾齐驱 (parity).
当时在 CPyUG 社区内进行了讨论, 为了构建网站的静态部分, 要不要引入 Node.js 组件;
讨论的结果是为了简化部署流程, 维持纯 Python 的方案. 幸好踩到的坑都可以规避 (work around),
也给上游提交了补丁, 这一套静态站也是平稳地上了线.</p>

<p>当时对静态站点生成器的理解, 是一个类似 Grunt 的结构, 本质上由多个互相独立的任务组成.
至于知道以 Gulp 为代表的流式构建系统, 那是后来看到我一位入了前端坑的本科同学写的<a href="http://www.cnblogs.com/myqianlan/p/4195999.html">介绍文章</a>之后的事情了.
那时我已经比较熟悉 Grunt 的思维方式了, 就导致个人对 Gulp 始终没法理解,
但毕竟基于流的处理方式能避免读写临时文件的 I/O, 这一点性能优势倒是很快就体会到了,
于是就决定抽时间好好研究下 Gulp.</p>

<p>于是时间到了 2015 年的 4 月底, 我想着利用 "五一" 的假期顺便把博客做了吧, 试着起了一个
Gulp 的前端项目骨架, 这次 Gulp 的文档一下就看懂了.</p>

<p>我想是时候把这个坑填上了.</p>

<h2>思路</h2>

<p>一个静态站点, 无非是由 HTML、CSS 组成的一堆文件, 可能还加上一些不涉及动态内容的 JS.
而构成站点实际内容的每个 HTML 页面里, 相当一部分却是公共的页面结构, 因此手工维护显然是不靠谱的.
解决这个问题早就有了现成方案 -- 模板系统 (templating). 然而手写 HTML 总之是比较蛋疼的;
尤其是使用过 Jade 这种模板语言之后给人的感受, 就像写过 Sass 之后再也不想手写裸
CSS 的感觉一样. 那么我们的想法就是:</p>

<ul>
<li>Jade -&gt; HTML</li>
<li>Sass -&gt; CSS</li>
</ul>

<p>这两步使用 Node.js 完成, 因为这样我就可以绕过 Python 前端工具比较弱的限制了.</p>

<p>我们的文章使用熟悉的 Markdown 撰写, Markdown 是编译成 HTML 的, 这部分内容要以某种方式综合到上一步生成的静态模板里.
其实在浏览器端用 JS 渲染 Markdown 的话也是可以的; 不过比较正统的方式还是一次性把所有工作都做完.
考虑到大部分现成的模板语言, 其标记本身都是直接写在 HTML 里的, 那我们为何不把标记写进 Jade 模板里,
这样 Jade 看见的是文本, 而编译的结果不就是另一个模板语言的合法输入了吗?</p>

<ul>
<li>Jade -&gt; Jinja2</li>
<li>Markdown -&gt; HTML 片段</li>
<li>Jinja2 -&gt; 完整 HTML 页面</li>
</ul>

<p>选用 Jinja2 是考虑到以下几点:</p>

<ul>
<li>语法和 Django 模板几乎一样, 写起来很爽, 我熟悉的另一个模板语言 Mako 写起来更像 PHP 的感觉, 代码跟输出是混在一起的, 相比之下就不够优雅</li>
<li>Jekyll 的模板也是类似的语法, 对面阵营的小伙伴们也熟悉, 有群众基础</li>
<li>这货貌似已经比 Mako 快了 (Mako 首页曾经声称自己性能最高, 但现在已经变成了 "非常接近 Jinja2")</li>
<li>Jade 貌似不方便扩展? 而且前一步是用 Node.js 完成的, 之后还是想用 Python</li>
</ul>

<p>这就是整体的实现思路了.</p>

<h2>实现</h2>

<p>Node.js 生成模板的方面, 并没有什么有趣的内容, 不提了.</p>

<p><strong>TODO: Python 部分的内容, 今天有点晚了先坑着吧 ;-)</strong></p>
</div>
        </article>
      </div>
    </div>
    <footer class="page__footer">
      <div class="page__footer__content">&copy; 2015<span class="page__footer__author">xen0n</span><span class="page__footer__links"><a href="https://github.com/xen0n" class="page__footer__link--github">github</a></span></div>
    </footer>
  </body>
</html>